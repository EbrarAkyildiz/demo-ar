<!DOCTYPE html>
<html lang="tr">

<head>
    <title>AR Studio Pro</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.02);
            --bg-card-hover: rgba(255, 255, 255, 0.04);
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.15);
            --cyan: #22d3ee;
            --green: #10b981;
            --red: #ef4444;
            --orange: #f97316;
            --text: #ffffff;
            --text-secondary: #71717a;
            --border: rgba(255, 255, 255, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.08) 0%, transparent 100%);
            border-bottom: 1px solid var(--border);
            padding: 24px 20px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--cyan) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .logo-text span {
            background: linear-gradient(135deg, var(--accent) 0%, var(--cyan) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Main Container */
        .main {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .card:hover {
            background: var(--bg-card-hover);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-icon {
            width: 36px;
            height: 36px;
            background: var(--accent-glow);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
        }

        .card-desc {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Project Selector */
        .project-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .project-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .project-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .project-btn.active {
            border-color: var(--accent);
            background: var(--accent-glow);
        }

        .project-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .project-meta {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .new-project-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-project-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        /* 3D Preview */
        #preview-container {
            width: 100%;
            height: 280px;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, #0f0f15 100%);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        #preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .preview-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0, 0, 0, 0.6);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 10px;
            color: var(--cyan);
            backdrop-filter: blur(10px);
        }

        .preview-controls {
            position: absolute;
            bottom: 12px;
            right: 12px;
            display: flex;
            gap: 6px;
        }

        .preview-control-btn {
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .preview-control-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Form Elements */
        .input-group {
            margin-bottom: 14px;
        }

        .input-label {
            display: block;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            font-weight: 500;
        }

        input[type="text"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select {
            cursor: pointer;
        }

        /* Sliders */
        .slider-group {
            margin-bottom: 16px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slider-title {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .slider-value {
            font-size: 13px;
            font-weight: 700;
            color: var(--cyan);
            min-width: 50px;
            text-align: right;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--bg-secondary);
            border-radius: 10px;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--cyan) 100%);
            border-radius: 50%;
            box-shadow: 0 4px 12px var(--accent-glow);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* Toggle */
        .toggle-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .toggle-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .toggle-info {}

        .toggle-title {
            font-size: 13px;
            font-weight: 500;
        }

        .toggle-desc {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .toggle {
            width: 48px;
            height: 28px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle.active {
            background: var(--green);
            border-color: var(--green);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle.active::after {
            left: 23px;
        }

        /* Map */
        #map {
            height: 180px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 12px;
        }

        .coords-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
        }

        .coord-item {
            text-align: center;
        }

        .coord-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .coord-value {
            font-size: 14px;
            font-weight: 600;
            font-family: monospace;
            color: var(--cyan);
        }

        .location-btn {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px dashed var(--border);
            border-radius: 10px;
            padding: 12px;
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .location-btn:hover {
            border-color: var(--green);
            color: var(--green);
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        /* Buttons */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--green) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Share Link */
        .share-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .share-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .share-link {
            font-size: 11px;
            color: var(--accent);
            word-break: break-all;
            line-height: 1.4;
            max-height: 60px;
            overflow-y: auto;
        }

        .copy-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .copy-btn:hover {
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Admin Place Button & Reticle */
        .admin-place-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background: var(--accent);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4);
            cursor: pointer;
            transition: all 0.2s;
        }

        .admin-place-btn:hover {
            transform: translateX(-50%) scale(1.05);
            background: var(--cyan);
        }

        .reticle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            z-index: 5;
            pointer-events: none;
        }

        .reticle::before,
        .reticle::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
        }

        .reticle::before {
            width: 2px;
            height: 10px;
            left: 50%;
            top: -15px;
            transform: translateX(-50%);
        }

        .reticle::after {
            width: 10px;
            height: 2px;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon">üèóÔ∏è</div>
            <div class="logo-text">AR <span>Studio</span></div>
        </div>
        <div class="header-subtitle">iOS & Android Uyumlu AR Deneyimi Olu≈ütur</div>
    </div>

    <div class="main">
        <!-- Projeler -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üìÅ</div>
                <div>
                    <div class="card-title">Projelerim</div>
                    <div class="card-desc">AR projelerini y√∂net</div>
                </div>
            </div>
            <div id="project-list" class="project-grid"></div>
            <button class="new-project-btn" onclick="createProject()">
                <span>‚ú®</span> Yeni Proje Olu≈ütur
            </button>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="card">
            <div class="empty-state">
                <div class="empty-icon">üéØ</div>
                <div class="empty-title">Proje se√ßin veya olu≈üturun</div>
                <div class="empty-desc">Yukarƒ±dan bir proje se√ßerek d√ºzenlemeye ba≈ülayƒ±n</div>
            </div>
        </div>

        <!-- Editor -->
        <div id="editor" class="hidden">
            <!-- AR Preview -->
            <div class="card" style="padding: 0; overflow: hidden;">
                <div id="preview-container">
                    <!-- Kamera Video -->
                    <video id="camera-video" autoplay muted playsinline
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                    <!-- 3D Canvas -->
                    <canvas id="preview-canvas" style="position: relative; z-index: 2;"></canvas>

                    <!-- Ni≈üangah (Sadece Kamera Modunda) -->
                    <div id="preview-reticle" class="reticle hidden"></div>

                    <!-- Mod Badge -->
                    <div class="preview-badge" id="mode-badge">3D √ñnizleme</div>

                    <!-- Yerle≈ütirme Butonu (Sadece Kamera Modunda) -->
                    <button id="admin-place-btn" class="admin-place-btn hidden" onclick="placeModelAtGPS()">
                        üìç Buraya Yerle≈ütir
                    </button>

                    <!-- Kontroller -->
                    <div class="preview-controls">
                        <button class="preview-control-btn" onclick="togglePreviewMode()" id="mode-btn"
                            title="Kamera Modu">üì∑</button>
                        <button class="preview-control-btn" onclick="resetCamera()">üîÑ</button>
                        <button class="preview-control-btn" onclick="toggleAutoRotate()">‚ö°</button>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('basic')">üìã Temel</div>
                <div class="tab" onclick="showTab('transform')">üîÑ D√∂n√º≈ü√ºm</div>
                <div class="tab" onclick="showTab('visual')">üé® G√∂r√ºn√ºm</div>
            </div>

            <!-- Tab: Temel -->
            <div id="tab-basic" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìù</div>
                        <div>
                            <div class="card-title">Proje Detaylarƒ±</div>
                            <div class="card-desc">Temel bilgileri d√ºzenle</div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">PROJE ADI</label>
                        <input type="text" id="p-name" placeholder="√ñrn: Maƒüaza AR Deneyimi"
                            oninput="updateField('name', this.value)">
                    </div>
                    <div class="input-group">
                        <label class="input-label">3D MODEL URL</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="url" id="p-model" placeholder="https://example.com/model.glb"
                                style="margin-bottom: 0;"
                                oninput="updateField('model', this.value); loadPreviewModel();">
                            <select id="p-samples" style="width: 120px; margin-bottom: 0;"
                                onchange="if(this.value) { document.getElementById('p-model').value=this.value; updateField('model', this.value); loadPreviewModel(); }">
                                <option value="">√ñrnekler</option>
                                <option
                                    value="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb">
                                    √ñrdek</option>
                                <option
                                    value="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb">
                                    Kask</option>
                                <option
                                    value="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF-Binary/Avocado.glb">
                                    Avokado</option>
                            </select>
                        </div>
                        <div id="model-status" style="font-size: 10px; color: var(--text-secondary); margin-top: 4px;">
                            Model y√ºklenmedi</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">A√áIKLAMA</label>
                        <textarea id="p-desc" placeholder="Kullanƒ±cƒ±larƒ±n g√∂receƒüi a√ßƒ±klama metni..."
                            oninput="updateField('desc', this.value)"></textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìç</div>
                        <div>
                            <div class="card-title">GPS Konumu</div>
                            <div class="card-desc">Modelin g√∂r√ºneceƒüi konum</div>
                        </div>
                    </div>
                    <div id="map"></div>
                    <div class="coords-display">
                        <div class="coord-item">
                            <div class="coord-label">ENLEM</div>
                            <div class="coord-value" id="lat-display">0.00000</div>
                        </div>
                        <div class="coord-item">
                            <div class="coord-label">BOYLAM</div>
                            <div class="coord-value" id="lon-display">0.00000</div>
                        </div>
                    </div>
                    <button class="location-btn" onclick="useMyLocation()">
                        <span>üì°</span> ≈ûuanki Konumumu Kullan
                    </button>
                </div>
            </div>

            <!-- Tab: D√∂n√º≈ü√ºm -->
            <div id="tab-transform" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìê</div>
                        <div>
                            <div class="card-title">Boyut & Konum</div>
                            <div class="card-desc">Model √∂l√ßeƒüini ayarla</div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">√ñl√ßek</span>
                            <span class="slider-value"><span id="v-scale">1</span>x</span>
                        </div>
                        <input type="range" id="p-scale" min="0.1" max="20" value="1" step="0.1"
                            oninput="updateSetting('scale', this.value)">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">Y√ºkseklik</span>
                            <span class="slider-value"><span id="v-alt">0</span>m</span>
                        </div>
                        <input type="range" id="p-alt" min="-10" max="20" value="0" step="0.1"
                            oninput="updateSetting('alt', this.value)">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üîÑ</div>
                        <div>
                            <div class="card-title">D√∂nd√ºrme</div>
                            <div class="card-desc">Model a√ßƒ±sƒ±nƒ± ayarla</div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">X Ekseni</span>
                            <span class="slider-value"><span id="v-rotX">0</span>¬∞</span>
                        </div>
                        <input type="range" id="p-rotX" min="0" max="360" value="0"
                            oninput="updateSetting('rotX', this.value)">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">Y Ekseni</span>
                            <span class="slider-value"><span id="v-rotY">0</span>¬∞</span>
                        </div>
                        <input type="range" id="p-rotY" min="0" max="360" value="0"
                            oninput="updateSetting('rotY', this.value)">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">Z Ekseni</span>
                            <span class="slider-value"><span id="v-rotZ">0</span>¬∞</span>
                        </div>
                        <input type="range" id="p-rotZ" min="0" max="360" value="0"
                            oninput="updateSetting('rotZ', this.value)">
                    </div>
                </div>
            </div>

            <!-- Tab: G√∂r√ºn√ºm -->
            <div id="tab-visual" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üí°</div>
                        <div>
                            <div class="card-title">I≈üƒ±klandƒ±rma</div>
                            <div class="card-desc">Sahne aydƒ±nlatmasƒ±nƒ± ayarla</div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">I≈üƒ±k Yoƒüunluƒüu</span>
                            <span class="slider-value" id="v-ambLight">1</span>
                        </div>
                        <input type="range" id="p-ambLight" min="0" max="3" value="1" step="0.1"
                            oninput="updateSetting('ambLight', this.value)">
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-title">G√∂lge Efekti</div>
                            <div class="toggle-desc">Model g√∂lge olu≈ütursun</div>
                        </div>
                        <div class="toggle" id="shadow-toggle" onclick="toggleShadow()"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö°</div>
                        <div>
                            <div class="card-title">Animasyon</div>
                            <div class="card-desc">Hareket efektlerini ayarla</div>
                        </div>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-info">
                            <div class="toggle-title">Otomatik D√∂nd√ºrme</div>
                            <div class="toggle-desc">Model kendi etrafƒ±nda d√∂ns√ºn</div>
                        </div>
                        <div class="toggle active" id="autorot-toggle" onclick="toggleAutoRot()"></div>
                    </div>
                    <div class="slider-group" style="margin-top: 16px;">
                        <div class="slider-header">
                            <span class="slider-title">D√∂nd√ºrme Hƒ±zƒ±</span>
                            <span class="slider-value" id="v-autoRot">1</span>
                        </div>
                        <input type="range" id="p-autoRot" min="0" max="5" value="1" step="0.1"
                            oninput="updateSetting('autoRot', this.value)">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üëÅÔ∏è</div>
                        <div>
                            <div class="card-title">G√∂r√ºn√ºrl√ºk</div>
                            <div class="card-desc">Model ne kadar uzaktan g√∂r√ºns√ºn</div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-title">Maksimum Mesafe</span>
                            <span class="slider-value"><span id="v-maxDist">500</span>m</span>
                        </div>
                        <input type="range" id="p-maxDist" min="10" max="1000" value="500" step="10"
                            oninput="updateSetting('maxDist', this.value)">
                    </div>
                </div>
            </div>

            <!-- Kaydet & Payla≈ü -->
            <div class="card">
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveProject()">üíæ Kaydet</button>
                    <button class="btn btn-danger" onclick="deleteProject()">üóëÔ∏è Sil</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üîó</div>
                    <div>
                        <div class="card-title">Payla≈üƒ±m Linki</div>
                        <div class="card-desc">Bu linki payla≈üarak AR deneyimini ba≈ülatƒ±n</div>
                    </div>
                </div>
                <div class="share-box">
                    <div class="share-label">PAYLA≈ûIM Lƒ∞NKƒ∞</div>
                    <div class="share-link" id="share-link">Projeyi kaydettikten sonra link olu≈üturulacak...</div>
                </div>
                <button class="copy-btn" onclick="copyLink()">
                    <span>üìã</span> Linki Kopyala
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== VERƒ∞ ==========
        let db = JSON.parse(localStorage.getItem('ar_studio_db')) || {};
        let activeProjectId = null;
        let previewScene, previewCamera, previewRenderer, previewModel, previewControls;
        let autoRotate = true;
        let cameraMode = false; // Kamera modu aktif mi?
        let cameraStream = null;
        let gridHelper = null;

        const defaultProject = {
            name: '', model: '', desc: '',
            lat: 41.015, lon: 28.979,
            scale: 1, alt: 0, rotX: 0, rotY: 0, rotZ: 0,
            ambLight: 1, shadow: false, autoRot: true, maxDist: 500
        };

        // ========== KAMERA MODU ==========
        async function togglePreviewMode() {
            cameraMode = !cameraMode;
            const video = document.getElementById('camera-video');
            const modeBtn = document.getElementById('mode-btn');
            const modeBadge = document.getElementById('mode-badge');

            if (cameraMode) {
                // Kamera moduna ge√ß
                try {
                    if (!cameraStream) {
                        cameraStream = await navigator.mediaDevices.getUserMedia({
                            video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
                        });
                    }
                    video.srcObject = cameraStream;
                    video.style.display = 'block';

                    // Sahne arka planƒ±nƒ± ≈üeffaf yap
                    previewScene.background = null;
                    previewRenderer.setClearColor(0x000000, 0);

                    // Grid'i gizle
                    if (gridHelper) gridHelper.visible = false;

                    // Ni≈üangah ve Butonu G√∂ster
                    document.getElementById('preview-reticle').classList.remove('hidden');
                    document.getElementById('admin-place-btn').classList.remove('hidden');

                    modeBtn.innerText = 'üéÆ';
                    modeBadge.innerText = 'üì∑ Kamera AR';
                    modeBadge.style.background = 'rgba(99,102,241,0.8)';
                } catch (err) {
                    console.error('Kamera a√ßƒ±lamadƒ±:', err);
                    cameraMode = false;
                    alert('Kamera a√ßƒ±lamadƒ±. ƒ∞zin verin.');
                }
            } else {
                // 3D moduna d√∂n
                video.style.display = 'none';

                // Sahne arka planƒ±nƒ± geri getir
                previewScene.background = new THREE.Color(0x0f0f15);
                previewRenderer.setClearColor(0x0f0f15, 1);

                // Grid'i g√∂ster
                if (gridHelper) gridHelper.visible = true;

                // Ni≈üangah ve Butonu Gizle
                document.getElementById('preview-reticle').classList.add('hidden');
                document.getElementById('admin-place-btn').classList.add('hidden');

                modeBtn.innerText = 'üì∑';
                modeBadge.innerText = '3D √ñnizleme';
                modeBadge.style.background = 'rgba(0,0,0,0.6)';
            }
        }

        function placeModelAtGPS() {
            if (!activeProjectId) return;

            if (navigator.geolocation) {
                const btn = document.getElementById('admin-place-btn');
                const originalText = btn.innerText;
                btn.innerText = "‚è≥ Konum Alƒ±nƒ±yor...";
                btn.disabled = true;

                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        const { latitude, longitude } = pos.coords;
                        db[activeProjectId].lat = latitude;
                        db[activeProjectId].lon = longitude;

                        // UI G√ºncelle
                        updateCoords();
                        if (marker) marker.setLatLng([latitude, longitude]);
                        if (map) map.setView([latitude, longitude], 17);

                        btn.innerText = "‚úÖ Yerle≈ütirildi!";
                        btn.style.background = "var(--green)";

                        // Otomatik Kaydet
                        saveToStorage();

                        setTimeout(() => {
                            btn.innerText = originalText;
                            btn.style.background = "var(--accent)";
                            btn.disabled = false;
                        }, 2000);

                        showToast("Konum ba≈üarƒ±yla g√ºncellendi ve kaydedildi!", "#10b981");
                    },
                    (err) => {
                        console.error("GPS Hatasƒ±:", err);
                        alert("GPS konumu alƒ±namadƒ±. ƒ∞zin verildiƒüinden emin olun.");
                        btn.innerText = originalText;
                        btn.disabled = false;
                    },
                    { enableHighAccuracy: true }
                );
            }
        }

        // ========== HARƒ∞TA ==========
        const map = L.map('map').setView([41.015, 28.979], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        let marker = L.marker([41.015, 28.979], { draggable: true }).addTo(map);

        marker.on('dragend', (e) => {
            if (!activeProjectId) return;
            db[activeProjectId].lat = e.target.getLatLng().lat;
            db[activeProjectId].lon = e.target.getLatLng().lng;
            updateCoords();
        });

        map.on('click', (e) => {
            if (!activeProjectId) return;
            marker.setLatLng(e.latlng);
            db[activeProjectId].lat = e.latlng.lat;
            db[activeProjectId].lon = e.latlng.lng;
            updateCoords();
        });

        // ========== 3D PREVIEW ==========
        function initPreview() {
            const container = document.getElementById('preview-container');
            const canvas = document.getElementById('preview-canvas');

            previewScene = new THREE.Scene();
            previewScene.background = new THREE.Color(0x0f0f15);

            previewCamera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 100);
            previewCamera.position.set(3, 2, 3);

            previewRenderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            previewRenderer.setSize(container.clientWidth, container.clientHeight);
            previewRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            previewRenderer.shadowMap.enabled = true;

            previewControls = new THREE.OrbitControls(previewCamera, canvas);
            previewControls.enableDamping = true;
            previewControls.dampingFactor = 0.05;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            previewScene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(5, 10, 5);
            dirLight.castShadow = true;
            previewScene.add(dirLight);

            // Grid
            gridHelper = new THREE.GridHelper(10, 20, 0x333340, 0x1a1a25);
            previewScene.add(gridHelper);

            // Varsayƒ±lan √∂rnek k√ºp ekle
            addDefaultCube();

            // Resize Observer to handle visibility changes
            const resizeObserver = new ResizeObserver(() => {
                if (container.clientWidth > 0 && container.clientHeight > 0) {
                    previewCamera.aspect = container.clientWidth / container.clientHeight;
                    previewCamera.updateProjectionMatrix();
                    previewRenderer.setSize(container.clientWidth, container.clientHeight);
                }
            });
            resizeObserver.observe(container);

            animatePreview();
        }

        function addDefaultCube() {
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshStandardMaterial({
                color: 0x6366f1,
                metalness: 0.3,
                roughness: 0.7
            });
            previewModel = new THREE.Mesh(geometry, material);
            previewModel.castShadow = true;
            previewModel.position.y = 0.5;
            previewScene.add(previewModel);
        }

        function animatePreview() {
            requestAnimationFrame(animatePreview);
            if (previewControls) previewControls.update();

            if (previewModel && autoRotate && activeProjectId && db[activeProjectId] && db[activeProjectId].autoRot) {
                previewModel.rotation.y += 0.005 * (db[activeProjectId].autoRot || 1);
            }

            if (previewRenderer && previewScene && previewCamera) {
                previewRenderer.render(previewScene, previewCamera);
            }
        }

        function loadPreviewModel() {
            if (!activeProjectId) return;

            const modelUrl = db[activeProjectId].model;
            const statusEl = document.getElementById('model-status');

            // Model URL yoksa varsayƒ±lan k√ºp g√∂ster
            if (!modelUrl || modelUrl.trim() === '') {
                if (previewModel) previewScene.remove(previewModel);
                addDefaultCube();
                updatePreviewTransform();
                statusEl.innerText = "Model URL girilmedi, varsayƒ±lan k√ºp g√∂steriliyor.";
                statusEl.style.color = "var(--text-secondary)";
                return;
            }

            if (previewModel) previewScene.remove(previewModel);
            statusEl.innerText = "Y√ºkleniyor...";
            statusEl.style.color = "var(--cyan)";

            const loader = new THREE.GLTFLoader();
            loader.load(
                modelUrl,
                (gltf) => {
                    previewModel = gltf.scene;
                    updatePreviewTransform();
                    previewScene.add(previewModel);

                    // Auto-fit camera logic
                    const box = new THREE.Box3().setFromObject(previewModel);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());

                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = previewCamera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                    cameraZ *= 2.5; // Biraz daha geri al (padding)

                    previewCamera.position.set(cameraZ, cameraZ, cameraZ);
                    previewControls.target.copy(center);
                    previewControls.update();

                    statusEl.innerText = "üì¶ Model ba≈üarƒ±yla y√ºklendi!";
                    statusEl.style.color = "var(--green)";
                },
                (xhr) => {
                    if (xhr.lengthComputable) {
                        const percent = Math.round((xhr.loaded / xhr.total) * 100);
                        statusEl.innerText = `Y√ºkleniyor: %${percent}`;
                    }
                },
                (error) => {
                    console.error('Model y√ºklenemedi:', error);
                    statusEl.innerText = "‚ùå Model y√ºklenemedi! (CORS veya URL hatasƒ±)";
                    statusEl.style.color = "var(--red)";
                    addDefaultCube();
                    updatePreviewTransform();
                }
            );
        }

        function updatePreviewTransform() {
            if (!previewModel || !activeProjectId) return;
            const p = db[activeProjectId];

            const s = p.scale || 1;
            previewModel.scale.set(s, s, s);
            previewModel.rotation.set((p.rotX || 0) * Math.PI / 180, (p.rotY || 0) * Math.PI / 180, (p.rotZ || 0) * Math.PI / 180);
            previewModel.position.y = p.alt || 0;
        }

        function resetCamera() {
            previewCamera.position.set(3, 2, 3);
            previewControls.target.set(0, 0, 0);
        }

        function toggleAutoRotate() {
            autoRotate = !autoRotate;
        }

        // ========== PROJE ƒ∞≈ûLEMLERƒ∞ ==========
        function createProject() {
            const name = prompt("Proje Adƒ±:");
            if (!name) return;

            const id = 'proj_' + Date.now();
            db[id] = { ...defaultProject, id, name };

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    db[id].lat = pos.coords.latitude;
                    db[id].lon = pos.coords.longitude;
                    saveToStorage();
                    loadProject(id);
                    refreshList();
                });
            } else {
                saveToStorage();
                loadProject(id);
                refreshList();
            }
        }

        function loadProject(id) {
            if (!id) {
                activeProjectId = null;
                document.getElementById('editor').classList.add('hidden');
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            }

            activeProjectId = id;
            const p = db[id];

            document.getElementById('editor').classList.remove('hidden');
            document.getElementById('empty-state').classList.add('hidden');

            document.getElementById('p-name').value = p.name || '';
            document.getElementById('p-model').value = p.model || '';
            document.getElementById('p-desc').value = p.desc || '';

            ['scale', 'alt', 'rotX', 'rotY', 'rotZ', 'ambLight', 'autoRot', 'maxDist'].forEach(f => {
                const el = document.getElementById('p-' + f);
                const vEl = document.getElementById('v-' + f);
                if (el && p[f] !== undefined) {
                    el.value = p[f];
                    if (vEl) vEl.innerText = p[f];
                }
            });

            document.getElementById('shadow-toggle').classList.toggle('active', p.shadow);
            document.getElementById('autorot-toggle').classList.toggle('active', p.autoRot !== false);

            marker.setLatLng([p.lat, p.lon]);
            map.setView([p.lat, p.lon], 15);
            updateCoords();

            loadPreviewModel();
            generateLink();

            // Highlight active project
            document.querySelectorAll('.project-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-id="${id}"]`);
            if (activeBtn) activeBtn.classList.add('active');
        }

        function saveProject() {
            if (!activeProjectId) return;
            db[activeProjectId].name = document.getElementById('p-name').value;
            db[activeProjectId].model = document.getElementById('p-model').value;
            db[activeProjectId].desc = document.getElementById('p-desc').value;
            saveToStorage();
            refreshList();
            generateLink();
            showToast('‚úì Kaydedildi!', '#10b981');
        }

        function deleteProject() {
            if (!activeProjectId || !confirm("Bu projeyi silmek istediƒüinizden emin misiniz?")) return;
            delete db[activeProjectId];
            saveToStorage();
            activeProjectId = null;
            refreshList();
            document.getElementById('editor').classList.add('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
        }

        // ========== AYARLAR ==========
        function updateField(key, value) { if (activeProjectId) db[activeProjectId][key] = value; }

        function updateSetting(key, value) {
            if (!activeProjectId) return;
            db[activeProjectId][key] = parseFloat(value);
            document.getElementById('v-' + key).innerText = value;
            updatePreviewTransform();
        }

        function toggleShadow() {
            if (!activeProjectId) return;
            const t = document.getElementById('shadow-toggle');
            t.classList.toggle('active');
            db[activeProjectId].shadow = t.classList.contains('active');
        }

        function toggleAutoRot() {
            if (!activeProjectId) return;
            const t = document.getElementById('autorot-toggle');
            t.classList.toggle('active');
            db[activeProjectId].autoRot = t.classList.contains('active');
        }

        // ========== YARDIMCI ==========
        function showTab(name) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            event.target.classList.add('active');
            document.getElementById('tab-' + name).classList.remove('hidden');
            if (name === 'basic') setTimeout(() => map.invalidateSize(), 100);
        }

        function useMyLocation() {
            if (!navigator.geolocation || !activeProjectId) return;
            navigator.geolocation.getCurrentPosition((pos) => {
                db[activeProjectId].lat = pos.coords.latitude;
                db[activeProjectId].lon = pos.coords.longitude;
                marker.setLatLng([pos.coords.latitude, pos.coords.longitude]);
                map.setView([pos.coords.latitude, pos.coords.longitude], 15);
                updateCoords();
            });
        }

        function updateCoords() {
            if (!activeProjectId) return;
            document.getElementById('lat-display').innerText = db[activeProjectId].lat.toFixed(5);
            document.getElementById('lon-display').innerText = db[activeProjectId].lon.toFixed(5);
        }

        function generateLink() {
            if (!activeProjectId) return;
            const p = db[activeProjectId];
            const data = { name: p.name, model: p.model, desc: p.desc, lat: p.lat, lon: p.lon, alt: p.alt, scale: p.scale, rotX: p.rotX, rotY: p.rotY, rotZ: p.rotZ, ambLight: p.ambLight, shadow: p.shadow, autoRot: p.autoRot, maxDist: p.maxDist };
            const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
            document.getElementById('share-link').innerText = window.location.href.replace('admin.html', 'index.html') + '?data=' + encoded;
        }

        function showToast(msg, color = "#6366f1") {
            const toast = document.createElement('div');
            toast.style.cssText = `position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:${color};color:white;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:600;z-index:9999;box-shadow: 0 10px 20px rgba(0,0,0,0.2);`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        function copyLink() {
            navigator.clipboard.writeText(document.getElementById('share-link').innerText);
            showToast("üìã Link Kopyalandƒ±!");
        }

        function saveToStorage() { localStorage.setItem('ar_studio_db', JSON.stringify(db)); }

        function refreshList() {
            const container = document.getElementById('project-list');
            container.innerHTML = '';

            const projects = Object.values(db);
            if (projects.length === 0) {
                container.innerHTML = '<div style="grid-column: span 2; text-align: center; padding: 20px; color: #666; font-size: 12px;">Hen√ºz proje yok</div>';
                return;
            }

            projects.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'project-btn' + (p.id === activeProjectId ? ' active' : '');
                btn.dataset.id = p.id;
                btn.onclick = () => loadProject(p.id);
                btn.innerHTML = `
                    <div class="project-name">${p.name || 'ƒ∞simsiz'}</div>
                    <div class="project-meta">${p.model ? 'üì¶ Model var' : '‚ö†Ô∏è Model yok'}</div>
                `;
                container.appendChild(btn);
            });
        }

        // Init
        refreshList();
        initPreview();
    </script>
</body>

</html>
