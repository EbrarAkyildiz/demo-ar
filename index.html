<!DOCTYPE html>
<html lang="tr">

<head>
    <title>AR ƒ∞n≈üaat ƒ∞zleyici</title>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            font-family: sans-serif;
            color: #fff;
        }

        #welcome {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #222, #000);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .btn-start {
            background: #007bff;
            color: white;
            border: none;
            padding: 20px 60px;
            border-radius: 100px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 123, 255, 0.4);
        }

        #dist-ui {
            position: fixed;
            top: 20px;
            width: 100%;
            display: none;
            justify-content: center;
            z-index: 1000;
            pointer-events: none;
        }

        .pill {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        video {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            object-fit: cover !important;
            z-index: -2 !important;
        }
    </style>
</head>

<body>
    <div id="welcome">
        <div style="font-size:50px; margin-bottom:20px">üèóÔ∏è</div>
        <h1 id="p-name">Proje Y√ºkleniyor...</h1>
        <button id="start-btn" class="btn-start" style="display:none" onclick="start()">AR DENEYƒ∞Mƒ∞Nƒ∞ BA≈ûLAT</button>
        <p id="status" style="color:#666; margin-top:20px">L√ºtfen bekleyin...</p>
    </div>
    <div id="dist-ui">
        <div class="pill" id="dist-txt">Mesafe hesaplanƒ±yor...</div>
    </div>
    <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-entity light="type: hemisphere; intensity: 2"></a-entity>
        <a-entity id="model" gltf-model=""></a-entity>
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>
    <script>
        const db = JSON.parse(localStorage.getItem('ar_db')) || {};
        const pid = new URLSearchParams(window.location.search).get('id');
        const config = db[pid];
        if (config) { document.getElementById('p-name').innerText = config.name; document.getElementById('start-btn').style.display = 'block'; document.getElementById('status').innerText = "Kamera ve GPS izni istenecek."; }
        else { document.getElementById('status').innerText = "Hata: Proje bulunamadƒ±."; }
        function start() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(() => { run(); }).catch(run);
            } else run();
        }
        function run() {
            document.getElementById('welcome').style.display = 'none'; document.getElementById('dist-ui').style.display = 'flex';
            const m = document.getElementById('model');
            m.setAttribute('gltf-model', 'url(' + config.model + ')');
            m.setAttribute('gps-entity-place', 'latitude:' + config.lat + '; longitude:' + config.lon + ';');
            m.setAttribute('scale', config.scale + ' ' + config.scale + ' ' + config.scale);
            m.setAttribute('rotation', '0 ' + config.rot + ' 0');
            m.setAttribute('position', '0 ' + config.alt + ' 0');
        }
        window.addEventListener('gps-camera-update-position', () => {
            const d = document.getElementById('model').getAttribute('distance');
            if (d !== null) document.getElementById('dist-txt').innerText = `ƒ∞n≈üaat: ${Math.round(d)} Metre Uzakta`;
        });
        setInterval(() => { const v = document.querySelector('video'); if (v) { v.style.zIndex = "-5"; v.style.position = "fixed"; v.style.objectFit = "cover"; } }, 1000);
    </script>
</body>

</html>
