<!DOCTYPE html>
<html lang="tr">
<head>
    <title>AR Ä°nÅŸaat Deneyimi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body, html { margin: 0; background: #000; color: #fff; font-family: sans-serif; height: 100vh; overflow: hidden; }
        #welcome {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle, #222, #000); z-index: 100; text-align: center;
        }
        #nav-header {
            position: fixed; top: 20px; width: 100%; display: none;
            justify-content: center; z-index: 50; pointer-events: none;
        }
        .info-pill { background: rgba(0,0,0,0.8); padding: 12px 30px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); }
        .btn { background: #007bff; color: #fff; border: none; padding: 20px 60px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 18px; }
        video { width: 100vw !important; height: 100vh !important; object-fit: cover !important; }
    </style>
</head>
<body>

    <div id="welcome">
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ—ï¸</div>
        <h1 id="proj-name">Proje YÃ¼kleniyor...</h1>
        <p id="proj-status">HazÄ±rlanÄ±yor, lÃ¼tfen bekleyin...</p>
        <button id="start-btn" class="btn" style="display:none" onclick="start()">DENEYÄ°MÄ° BAÅLAT</button>
    </div>

    <div id="nav-header">
        <div class="info-pill" id="dist-text">Konum hesaplanÄ±yor...</div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-entity light="type: hemisphere; intensity: 2"></a-entity>
        <a-entity id="user-model" gltf-model="" gps-entity-place="latitude: 0; longitude: 0;"></a-entity>
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        const db = JSON.parse(localStorage.getItem('ar_db')) || {};
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        let config = db[id];

        if (config) {
            document.getElementById('proj-name').innerText = config.name;
            document.getElementById('proj-status').innerText = "Deneyim hazÄ±r.";
            document.getElementById('start-btn').style.display = "block";
        } else {
            document.getElementById('proj-status').innerText = "HATA: Proje bulunamadÄ±!";
        }

        function start() {
            document.getElementById('welcome').style.display = 'none';
            document.getElementById('nav-header').style.display = 'flex';
            
            const m = document.getElementById('user-model');
            m.setAttribute('gltf-model', `url(${config.model})`);
            m.setAttribute('gps-entity-place', `latitude: ${config.lat}; longitude: ${config.lon};`);
            m.setAttribute('scale', `${config.scale} ${config.scale} ${config.scale}`);
            m.setAttribute('rotation', `0 ${config.rot} 0`);
            m.setAttribute('position', `0 ${config.alt} 0`);
        }

        window.addEventListener('gps-camera-update-position', (e) => {
            const m = document.getElementById('user-model');
            const d = m.getAttribute('distance');
            if (d !== null) document.getElementById('dist-text').innerText = `Ä°nÅŸaat: ${Math.round(d)} Metre`;
        });
    </script>
</body>
</html>
