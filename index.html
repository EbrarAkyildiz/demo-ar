<!DOCTYPE html>
<html lang="tr">

<head>
    <title>AR ƒ∞n≈üaat Deneyimi</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- AR K√ºt√ºphaneleri -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, sans-serif;
            background: #000;
            color: #fff;
        }

        /* --- KAR≈ûILAMA EKRANI --- */
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #2a2a2a 0%, #000 100%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .icon-box {
            width: 100px;
            height: 100px;
            background: #333;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .btn-start {
            background: #007bff;
            color: white;
            border: none;
            padding: 20px 60px;
            border-radius: 100px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 5px 20px rgba(0, 123, 255, 0.4);
        }

        .btn-start:active {
            transform: scale(0.95);
        }

        /* --- √úST NAVƒ∞GASYON --- */
        #nav-header {
            position: fixed;
            top: 20px;
            width: 100%;
            z-index: 1000;
            display: none;
            justify-content: center;
            pointer-events: none;
        }

        .dist-pill {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            padding: 12px 30px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        video {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: cover !important;
            position: absolute;
        }
    </style>
</head>

<body>

    <div id="welcome-screen">
        <div class="icon-box">üèóÔ∏è</div>
        <h1 id="proj-name">Proje Y√ºkleniyor...</h1>
        <p id="proj-desc" style="color: #888; margin-bottom: 40px;">Artƒ±rƒ±lmƒ±≈ü Ger√ßeklik ƒ∞n≈üaat Sim√ºlasyonu</p>
        <button id="btn-start" class="btn-start" style="display:none" onclick="startAR()">AR DENEYƒ∞Mƒ∞Nƒ∞ BA≈ûLAT</button>
        <div id="error-msg" style="color: #dc3545; display:none; margin-top: 20px;">Proje bulunamadƒ±. L√ºtfen linki
            kontrol edin.</div>
    </div>

    <div id="nav-header">
        <div class="dist-pill" id="live-dist">ƒ∞n≈üaat aranƒ±yor...</div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;">
        <a-entity light="type: hemisphere; intensity: 2"></a-entity>
        <a-entity light="type: directional; intensity: 1.5;" position="1 2 1"></a-entity>
        <a-entity id="main-model" gltf-model="" gps-entity-place="latitude: 0; longitude: 0;"></a-entity>
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        // Veriyi √ßek
        const db = JSON.parse(localStorage.getItem('ar_db')) || {};
        const urlParams = new URLSearchParams(window.location.search);
        const pid = urlParams.get('id');
        const config = db[pid];

        if (config) {
            document.getElementById('proj-name').innerText = config.name;
            document.getElementById('btn-start').style.display = 'block';
        } else {
            document.getElementById('error-msg').style.display = 'block';
            document.getElementById('proj-desc').innerText = "Ge√ßersiz veya silinmi≈ü proje linki.";
        }

        function startAR() {
            if (!config) return;
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('nav-header').style.display = 'flex';

            const m = document.getElementById('main-model');
            m.setAttribute('gltf-model', `url(${config.model})`);
            m.setAttribute('gps-entity-place', `latitude: ${config.lat}; longitude: ${config.lon};`);
            m.setAttribute('scale', `${config.scale} ${config.scale} ${config.scale}`);
            m.setAttribute('rotation', `0 ${config.rot} 0`);
            m.setAttribute('position', `0 ${config.alt} 0`);
        }

        window.addEventListener('gps-camera-update-position', (e) => {
            const m = document.getElementById('main-model');
            const d = m.getAttribute('distance');
            if (d !== null) {
                document.getElementById('live-dist').innerText = `ƒ∞n≈üaat: ${Math.round(d)} Metre Uzakta`;
            }
        });

        // Video tam ekran fix
        setInterval(() => {
            const v = document.querySelector('video');
            if (v) v.style.objectFit = "cover";
        }, 1000);
    </script>
</body>

</html>
